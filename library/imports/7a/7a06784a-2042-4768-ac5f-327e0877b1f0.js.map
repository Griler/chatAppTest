{"version":3,"sources":["../../../../../assets/Script/ChatForm/assets/Script/ChatForm/RoomChatManager.js"],"names":["io","require","constants","cc","Class","extends","Component","properties","chatEditBox","EditBox","chatTextLayout","Prefab","chatTextLayoutFriend","labelPrefab","srcollViewChat","ScrollView","atlasImg","SpriteAtlas","onLoad","socket","log","id","wordsInMessage","data","imgNameData","nameUserData","chatMessage","socketId","on","e","chatData","JSON","parse","message","createChatTextFriend","sendMessageToServer","nameUser","node","getChildByName","getComponent","Label","string","imgName","Sprite","spriteFrame","name","jsonString","stringify","emit","blur","focus","setFocus","createChatText","split","chatTextNode","instantiate","index","length","labelNode","labelComponent","position","v2","angle","setParent","content","scrollToBottom","soketID","setAvatar","x","getSpriteFrames"],"mappings":"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","file":"RoomChatManager.js","sourceRoot":"../../../../../assets/Script/ChatForm","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\nconst io = require('socket.io-client');\nconst constants = require(\"constants\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        chatEditBox: cc.EditBox,\n        chatTextLayout: cc.Prefab,\n        chatTextLayoutFriend: cc.Prefab,\n        labelPrefab: cc.Prefab,\n        srcollViewChat: cc.ScrollView,\n        atlasImg:cc.SpriteAtlas\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        this.socket = io('http://localhost:4000');\n        cc.log(this.socket.id)\n        this.wordsInMessage;\n        this.data = {\n            imgNameData: \"\",\n            nameUserData: \"\",\n            chatMessage: \"\",\n            socketId: \"\",\n        }\n        this.socket.on('chatMessage', (e) => {\n            cc.log(this.socket.id)\n            cc.log(e);\n            this.chatData = JSON.parse(e.message);\n                this.createChatTextFriend(this.chatData.nameUserData, this.chatData.imgNameData,\n                this.chatData.chatMessage, this.chatData.socketId)\n        });\n    },\n    sendMessageToServer() {\n        const nameUser = this.node.getChildByName('AvatarLayout')\n            .getChildByName(\"Name\").getComponent(cc.Label).string;\n        const imgName = this.node.getChildByName('AvatarLayout')\n            .getChildByName(\"Avatar\").getComponent(cc.Sprite).spriteFrame.name;\n        this.data.imgNameData = imgName;\n        this.data.nameUserData = nameUser;\n        this.data.chatMessage = this.chatEditBox.string;\n        this.data.socketId = this.socket.id;\n        let jsonString = JSON.stringify(this.data);\n        if (this.chatEditBox.string !== '') {\n            this.socket.emit('chatMessage',\n                {message: jsonString});\n            this.chatEditBox.blur();\n            this.chatEditBox.focus();\n        }\n    },\n    setFocus() {\n        this.chatEditBox.focus();\n    },\n    createChatText() {\n        if (this.chatEditBox.string !== '') {\n            this.wordsInMessage = this.chatEditBox.string.split(\" \");\n            const chatTextNode = cc.instantiate(this.chatTextLayout);\n            chatTextNode.getChildByName('Info')\n                .getChildByName(\"Avatar\").getComponent(cc.Sprite).spriteFrame =\n                this.node.getChildByName('AvatarLayout')\n                    .getChildByName(\"Avatar\").getComponent(cc.Sprite).spriteFrame;\n            chatTextNode.getChildByName('ChatString')\n                .getChildByName(\"Name\").getComponent(cc.Label).string =\n                this.node.getChildByName('AvatarLayout')\n                    .getChildByName(\"Name\").getComponent(cc.Label).string\n            for (let index = 0; index < this.wordsInMessage.length; index++) {\n                {\n                    const labelNode = cc.instantiate(this.labelPrefab);\n                    const labelComponent = labelNode.getComponent(cc.Label);\n                    labelComponent.string = `${this.wordsInMessage[index]} `;\n                    labelNode.position = cc.v2(150, 0);\n                    labelNode.angle = cc.v2(0, 0);\n                    labelNode.setParent(chatTextNode.getChildByName(\"ChatString\")\n                        .getChildByName(\"chatText\"));\n                }\n            }\n            chatTextNode.setParent(this.srcollViewChat.content);\n            //this.node.addChild(chatTextNode);\n            this.chatEditBox.string = '';\n            this.srcollViewChat.scrollToBottom();\n        }\n    },\n    // update (dt) {},\n    createChatTextFriend(nameUserData, imgNameData, chatMessage, soketID) {\n        if (soketID !== this.socket.id) {\n            cc.log(\"hello1\");\n            this.wordsInMessage = chatMessage.split(\" \");\n            const chatTextNode = cc.instantiate(this.chatTextLayoutFriend);\n            chatTextNode.getChildByName('Info')\n                .getChildByName(\"Avatar\")\n                .getComponent(cc.Sprite)\n                .spriteFrame = this.setAvatar(imgNameData);\n            chatTextNode.getChildByName('ChatString')\n                .getChildByName(\"Name\").getComponent(cc.Label).string = nameUserData;\n            for (let index = 0; index < this.wordsInMessage.length; index++) {\n                {\n                    const labelNode = cc.instantiate(this.labelPrefab);\n                    const labelComponent = labelNode.getComponent(cc.Label);\n                    labelComponent.string = `${this.wordsInMessage[index]} `;\n                    labelNode.position = cc.v2(150, 0);\n                    labelNode.angle = cc.v2(0, 0);\n                    labelNode.setParent(chatTextNode.getChildByName(\"ChatString\")\n                        .getChildByName(\"chatText\"));\n                }\n            }\n            chatTextNode.setParent(this.srcollViewChat.content);\n            //this.node.addChild(chatTextNode);\n            this.chatEditBox.string = '';\n            this.srcollViewChat.scrollToBottom();\n        }\n    },\n    setAvatar: function (imgName) {\n        //cc.log(this.avatar.imageAtlas);\n        for (let x in this.atlasImg.getSpriteFrames()) {\n            if (this.atlasImg.getSpriteFrames()[x].name === imgName) {\n                return this.atlasImg.getSpriteFrames()[x];\n            }\n        }\n    },\n\n\n});\n"]}