{"version":3,"sources":["../../../../../assets/Script/ChatForm/assets/Script/ChatForm/SendChatManager.js"],"names":["io","require","constants","cc","Class","extends","Component","properties","chatEditBox","EditBox","chatText","Prefab","labelPrefab","srcollViewChat","ScrollView","onLoad","wordsInMessage","data","imgNameData","nameUserData","chatMessage","start","sendMessageToServer","nameUser","node","getChildByName","getComponent","Label","string","imgName","Sprite","spriteFrame","name","log","jsonString","JSON","stringify","socket","emit","message","blur","focus","setFocus","createChatText","split","chatTextNode","instantiate","index","length","labelNode","labelComponent","cacheMode","fontSize","lineHeight","position","v2","angle","setParent","content","scrollToBottom"],"mappings":"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","file":"SendChatManager.js","sourceRoot":"../../../../../assets/Script/ChatForm","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\nconst io = require('socket.io-client');\nconst constants = require(\"constants\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        chatEditBox: cc.EditBox,\n        chatText: cc.Prefab,\n        labelPrefab: cc.Prefab,\n        srcollViewChat: cc.ScrollView,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        this.wordsInMessage;\n        this.data = {\n            imgNameData: \"\",\n            nameUserData: \"\",\n            chatMessage: \"\"\n        }\n    },\n    start() {\n    },\n    sendMessageToServer() {\n        const nameUser = this.node.getChildByName('AvatarLayout')\n            .getChildByName(\"Name\").getComponent(cc.Label).string;\n        const imgName = this.node.getChildByName('AvatarLayout')\n            .getChildByName(\"Avatar\").getComponent(cc.Sprite).spriteFrame.name;\n        this.data.imgNameData = imgName;\n        this.data.nameUserData = nameUser;\n        this.data.chatMessage = this.chatEditBox.string;\n        cc.log(this.data);\n        let jsonString = JSON.stringify(this.data);\n        cc.log(jsonString);\n        this.socket = io('http://localhost:4000');\n        if (this.chatEditBox.string !== '') {\n            this.socket.emit('chatMessage',\n                {message: jsonString});\n            this.chatEditBox.blur();\n            this.chatEditBox.focus();\n        }\n    },\n    setFocus() {\n        this.chatEditBox.focus();\n    },\n    createChatText() {\n        if (this.chatEditBox.string !== '') {\n            this.wordsInMessage = this.chatEditBox.string.split(\" \");\n            cc.log(\"create\");\n            cc.log(this.chatEditBox.string);\n            const chatTextNode = cc.instantiate(this.chatText);\n            chatTextNode.getChildByName('Info')\n                .getChildByName(\"Avatar\").getComponent(cc.Sprite).spriteFrame =\n                this.node.getChildByName('AvatarLayout')\n                    .getChildByName(\"Avatar\").getComponent(cc.Sprite).spriteFrame\n            chatTextNode.getChildByName('Info')\n                .getChildByName(\"Name\").getComponent(cc.Label).string =\n                this.node.getChildByName('AvatarLayout')\n                    .getChildByName(\"Name\").getComponent(cc.Label).string\n            for (let index = 0; index < this.wordsInMessage.length; index++) {\n                {\n                    const labelNode = cc.instantiate(this.labelPrefab);\n                    const labelComponent = labelNode.getComponent(cc.Label);\n                    labelComponent.string = `${this.wordsInMessage[index]} `;\n                    labelComponent.cacheMode = 2;\n                    labelComponent.fontSize = 15;\n                    labelComponent.lineHeight = 15;\n                    //labelComponent.overflow = 3;\n                    labelNode.position = cc.v2(150, 0);\n                    labelNode.angle = cc.v2(0, 0);\n                    labelNode.setParent(chatTextNode.getChildByName(\"chatText\"));\n                }\n            }\n            chatTextNode.setParent(this.srcollViewChat.content);\n            //this.node.addChild(chatTextNode);\n            this.chatEditBox.string = '';\n            this.srcollViewChat.scrollToBottom(0.005);\n        }\n    },\n    // update (dt) {},\n});\n"]}