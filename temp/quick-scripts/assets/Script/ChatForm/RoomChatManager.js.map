{"version":3,"sources":["RoomChatManager.js"],"names":["io","require","constants","cc","Class","extends","Component","properties","chatEditBox","EditBox","chatTextLayout","Prefab","chatTextLayoutFriend","labelPrefab","srcollViewChat","ScrollView","atlasImg","SpriteAtlas","onLoad","socket","createSoketIo","wordsInMessage","data","imgNameData","nameUserData","chatMessage","socketId","on","e","log","id","chatData","JSON","parse","message","createChatTextFriend","sendMessageToServer","nameUser","node","getChildByName","getComponent","Label","string","imgName","Sprite","spriteFrame","name","jsonString","stringify","emit","blur","focus","setFocus","createChatText","split","chatTextNode","instantiate","index","length","labelNode","labelComponent","position","v2","angle","setParent","content","scrollToBottom","soketID","setAvatar","x","getSpriteFrames"],"mappings":"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","file":"RoomChatManager.js","sourceRoot":"../../../../../assets/Script/ChatForm","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\nconst io = require('Test');\nconst constants = require(\"constants\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        chatEditBox: cc.EditBox,\n        chatTextLayout: cc.Prefab,\n        chatTextLayoutFriend: cc.Prefab,\n        labelPrefab: cc.Prefab,\n        srcollViewChat: cc.ScrollView,\n        atlasImg:cc.SpriteAtlas\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        this.socket = io.createSoketIo();\n        this.wordsInMessage;\n        this.data = {\n            imgNameData: \"\",\n            nameUserData: \"\",\n            chatMessage: \"\",\n            socketId: \"\",\n        }\n        this.socket.on('chatMessage', (e) => {\n            cc.log(this.socket.id)\n            cc.log(e);\n            this.chatData = JSON.parse(e.message);\n                this.createChatTextFriend(this.chatData.nameUserData, this.chatData.imgNameData,\n                this.chatData.chatMessage, this.chatData.socketId)\n        });\n    },\n    sendMessageToServer() {\n        const nameUser = this.node.getChildByName('AvatarLayout')\n            .getChildByName(\"Name\").getComponent(cc.Label).string;\n        const imgName = this.node.getChildByName('AvatarLayout')\n            .getChildByName(\"Avatar\").getComponent(cc.Sprite).spriteFrame.name;\n        this.data.imgNameData = imgName;\n        this.data.nameUserData = nameUser;\n        this.data.chatMessage = this.chatEditBox.string;\n        this.data.socketId = this.socket.id;\n        let jsonString = JSON.stringify(this.data);\n        if (this.chatEditBox.string !== '') {\n            this.socket.emit('chatMessage',\n                {message: jsonString});\n            this.chatEditBox.blur();\n            this.chatEditBox.focus();\n        }\n    },\n    setFocus() {\n        this.chatEditBox.focus();\n    },\n    createChatText() {\n        if (this.chatEditBox.string !== '') {\n            this.wordsInMessage = this.chatEditBox.string.split(\" \");\n            const chatTextNode = cc.instantiate(this.chatTextLayout);\n            chatTextNode.getChildByName('Info')\n                .getChildByName(\"Avatar\").getComponent(cc.Sprite).spriteFrame =\n                this.node.getChildByName('AvatarLayout')\n                    .getChildByName(\"Avatar\").getComponent(cc.Sprite).spriteFrame;\n            chatTextNode.getChildByName('ChatString')\n                .getChildByName(\"Name\").getComponent(cc.Label).string =\n                this.node.getChildByName('AvatarLayout')\n                    .getChildByName(\"Name\").getComponent(cc.Label).string\n            for (let index = 0; index < this.wordsInMessage.length; index++) {\n                {\n                    const labelNode = cc.instantiate(this.labelPrefab);\n                    const labelComponent = labelNode.getComponent(cc.Label);\n                    labelComponent.string = `${this.wordsInMessage[index]} `;\n                    labelNode.position = cc.v2(150, 0);\n                    labelNode.angle = cc.v2(0, 0);\n                    labelNode.setParent(chatTextNode.getChildByName(\"ChatString\")\n                        .getChildByName(\"chatText\"));\n                }\n            }\n            chatTextNode.setParent(this.srcollViewChat.content);\n            //this.node.addChild(chatTextNode);\n            this.chatEditBox.string = '';\n            this.srcollViewChat.scrollToBottom();\n        }\n    },\n    // update (dt) {},\n    createChatTextFriend(nameUserData, imgNameData, chatMessage, soketID) {\n        if (soketID !== this.socket.id) {\n            cc.log(\"hello1\");\n            this.wordsInMessage = chatMessage.split(\" \");\n            const chatTextNode = cc.instantiate(this.chatTextLayoutFriend);\n            chatTextNode.getChildByName('Info')\n                .getChildByName(\"Avatar\")\n                .getComponent(cc.Sprite)\n                .spriteFrame = this.setAvatar(imgNameData);\n            chatTextNode.getChildByName('ChatString')\n                .getChildByName(\"Name\").getComponent(cc.Label).string = nameUserData;\n            for (let index = 0; index < this.wordsInMessage.length; index++) {\n                {\n                    const labelNode = cc.instantiate(this.labelPrefab);\n                    const labelComponent = labelNode.getComponent(cc.Label);\n                    labelComponent.string = `${this.wordsInMessage[index]} `;\n                    labelNode.position = cc.v2(150, 0);\n                    labelNode.angle = cc.v2(0, 0);\n                    labelNode.setParent(chatTextNode.getChildByName(\"ChatString\")\n                        .getChildByName(\"chatText\"));\n                }\n            }\n            chatTextNode.setParent(this.srcollViewChat.content);\n            //this.node.addChild(chatTextNode);\n            this.chatEditBox.string = '';\n            this.srcollViewChat.scrollToBottom();\n        }\n    },\n    setAvatar: function (imgName) {\n        //cc.log(this.avatar.imageAtlas);\n        for (let x in this.atlasImg.getSpriteFrames()) {\n            if (this.atlasImg.getSpriteFrames()[x].name === imgName) {\n                return this.atlasImg.getSpriteFrames()[x];\n            }\n        }\n    },\n\n\n});\n"]}